<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador - Athenas Assessoria</title>

  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5MJDWDSZ');</script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --color-primary: #c6ac7c;
      --color-primary-dark: #b09565;
      --color-text: #2d2c2d;
      --color-text-light: #666;
      --color-bg: #ffffff;
      --color-bg-alt: #f8f9fa;
      --color-error: #e74c3c;
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --font-main: "Montserrat", sans-serif;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: var(--font-main); background-color: transparent; color: var(--color-text); overflow-x: hidden; }
    .simulator-container { width: 100%; max-width: 800px; margin: 10px auto; background: var(--color-bg); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); overflow: hidden; display: flex; flex-direction: column; }
    header { padding: 24px; background-color: var(--color-text); border-bottom: 2px solid var(--color-primary); }
    .progress-container { height: 4px; background: #eee; width: 100%; }
    .progress-bar { height: 100%; background: var(--color-primary); width: 0%; transition: width 0.5s ease; }
    .step-content { padding: 40px; display: none; animation: fadeIn 0.4s ease forwards; }
    .step-content.active { display: block; }
    .step-title { font-size: 24px; font-weight: 600; margin-bottom: 32px; text-align: center; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .error-shake { animation: shake 0.4s ease; }

    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; margin-bottom: 32px; }
    .card { background: white; border: 1px solid #eee; border-radius: var(--radius-sm); padding: 32px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
    .card:hover { border-color: var(--color-primary); transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .card-icon { font-size: 40px; margin-bottom: 16px; }
    
    .form-group { margin-bottom: 20px; position: relative; }
    .form-group label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
    .form-group input { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: var(--radius-sm); font-size: 16px; transition: border-color 0.3s; }
    .form-group input.input-error { border-color: var(--color-error); background-color: #fff8f8; }
    
    .currency-input { position: relative; }
    .currency-prefix { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #999; font-weight: 600; pointer-events: none; }
    .currency-input input { padding-left: 46px; }
    
    .nav-buttons { display: flex; gap: 16px; margin-top: 32px; }
    .btn { flex: 1; padding: 16px; border-radius: var(--radius-sm); border: none; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%); color: white; font-size: 16px; }
    .btn-outline { background: #f0f0f0; color: #666; }
    
    .slider { -webkit-appearance: none; width: 100%; height: 8px; background: #eee; border-radius: 5px; margin: 20px 0; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: var(--color-primary); cursor: pointer; box-shadow: 0 0 0 4px rgba(198, 172, 124, 0.2); }
    
    .slider-labels { display: flex; justify-content: space-between; font-size: 12px; color: var(--color-text-light); margin-top: -10px; font-weight: 500; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } .step-content { padding: 24px 20px; } }
  </style>
</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5MJDWDSZ"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <div class="simulator-container">
    <header><div class="progress-container"><div class="progress-bar" id="progressBar"></div></div></header>
    <main id="simulatorMain">
      
      <div class="step-content active" id="step1">
        <h2 class="step-title">Qual objetivo do cr√©dito?</h2>
        <div class="cards-grid">
          <div class="card" onclick="selectObjective('adquirir')">
            <div class="card-icon">üè†</div>
            <h3>Quero adquirir um im√≥vel</h3>
          </div>
          <div class="card" onclick="selectObjective('credito')">
            <div class="card-icon">üí∞</div>
            <h3>Quero um cr√©dito usando meu im√≥vel</h3>
          </div>
        </div>
      </div>

      <div class="step-content" id="step2">
        <h2 class="step-title">Qual o Perfil do seu Im√≥vel:</h2>
        <div class="cards-grid">
          <div class="card" onclick="selectProperty('casa')">üè°<br>Casa</div>
          <div class="card" onclick="selectProperty('apartamento')">üè¢<br>Apartamento</div>
          <div class="card" onclick="selectProperty('comercial')">üè¨<br>Comercial</div>
          <div class="card" onclick="selectProperty('outros')">‚ùì<br>Outros</div>
        </div>
        <button class="btn btn-outline" onclick="prevStep()">Voltar</button>
      </div>

      <div class="step-content" id="step3">
        <h2 class="step-title">Quais os valores da opera√ß√£o?</h2>
        <div class="form-group" id="containerPropertyValue">
          <label>Valor aproximado do im√≥vel</label>
          <div class="currency-input">
            <span class="currency-prefix">R$</span>
            <input type="text" id="propertyValue" inputmode="numeric" placeholder="0,00">
          </div>
          <small id="propertyHelper" style="color:#999; font-size:12px; display:block; margin-top:5px;">O valor m√≠nimo do im√≥vel deve ser R$ 300.000,00</small>
        </div>

        <div id="creditSection" style="display:none; margin-top:30px;">
          <label style="font-weight:600; font-size:14px;">Quanto voc√™ precisa de cr√©dito?</label>
          <input type="range" id="creditSlider" class="slider">
          <div class="slider-labels">
            <span id="sliderMin">R$ 100.000,00</span>
            <span id="sliderMax">R$ 0,00</span>
          </div>
          <input type="text" id="creditValue" readonly style="margin-top: 25px; font-weight: bold; color: var(--color-primary); border:none; text-align:center; width:100%; font-size:22px; background:transparent;">
        </div>

        <div class="nav-buttons">
          <button class="btn btn-outline" onclick="prevStep()">Voltar</button>
          <button class="btn" onclick="validateStep3()">Continuar</button>
        </div>
      </div>

      <div class="step-content" id="step4">
        <h2 class="step-title">O im√≥vel tem matr√≠cula / escritura?</h2>
        <div class="cards-grid">
          <div class="card" onclick="selectLegal('sim')">‚úÖ Sim, possui matr√≠cula</div>
          <div class="card" onclick="selectLegal('nao')">‚ùå N√£o possui</div>
        </div>
        <button class="btn btn-outline" onclick="prevStep()">Voltar</button>
      </div>

      <div class="step-content" id="step5">
        <h2 class="step-title">Preencha seus dados para receber a simula√ß√£o</h2>
        <div class="grid-2">
            <div class="form-group"><label>Nome Completo</label><input type="text" id="clientName"></div>
            <div class="form-group"><label>CPF</label><input type="text" id="clientCPF" placeholder="000.000.000-00"></div>
        </div>
        <div class="grid-2">
          <div class="form-group">
            <label>Renda Familiar Mensal</label>
            <div class="currency-input"><span class="currency-prefix">R$</span><input type="text" id="clientIncome" inputmode="numeric" placeholder="0,00"></div>
          </div>
          <div class="form-group"><label>Telefone (WhatsApp)</label><input type="text" id="clientPhone" placeholder="(00) 00000-0000"></div>
        </div>
        <div class="grid-2">
          <div class="form-group"><label>Data de Nascimento</label><input type="text" id="clientDob" placeholder="DD/MM/AAAA"></div>
          <div class="form-group"><label>CEP</label><input type="text" id="clientCep" placeholder="00000-000"></div>
        </div>
        <div class="nav-buttons">
          <button class="btn btn-outline" onclick="prevStep()">Voltar</button>
          <button class="btn" onclick="submitForm()">Solicitar Simula√ß√£o</button>
        </div>
      </div>

      <div class="step-content" id="stepSuccess">
        <div style="text-align:center; padding: 40px 20px;">
          <div style="font-size:60px; margin-bottom: 24px;">‚ú®</div>
          <h2 style="color:var(--color-primary); margin-bottom: 16px;">Solicita√ß√£o Enviada!</h2>
          <p>Um especialista da <strong>Athenas Assessoria</strong> entrar√° em contato em breve.</p>
        </div>
      </div>
    </main>
  </div>

  <script>
    const state = { objective:'', type:'', propertyVal:0, creditVal:0, legal:'', client:{} };
    let currentStep = 1;

    function maskMoney(input) {
      let v = input.value.replace(/\D/g, "");
      if (v === "") return 0;
      let floatV = parseFloat(v) / 100;
      input.value = floatV.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      return floatV;
    }

    function formatBRL(val) {
      return val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function sendHeight() {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ height: document.body.scrollHeight }, "*");
      }
    }

    function showStep(n) {
      document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + n).classList.add('active');
      document.getElementById('progressBar').style.width = ((n - 1) / 4) * 100 + '%';
      setTimeout(sendHeight, 100);
    }

    function selectObjective(v) { state.objective = v; nextStep(); }
    function selectProperty(v) { state.type = v; nextStep(); }
    function selectLegal(v) { state.legal = v; nextStep(); }
    function nextStep() { currentStep++; showStep(currentStep); }
    function prevStep() { currentStep--; showStep(currentStep); }

    document.getElementById('propertyValue').addEventListener('input', (e) => {
      const input = e.target;
      const v = maskMoney(input);
      const section = document.getElementById('creditSection');
      const helper = document.getElementById('propertyHelper');
      const slider = document.getElementById('creditSlider');
      const maxLabel = document.getElementById('sliderMax');
      input.classList.remove('input-error');
      if (v >= 300000) {
        section.style.display = 'block';
        helper.style.color = 'green';
        helper.innerText = "Valor aceito para simula√ß√£o.";
        const maxCredit = v * 0.6;
        slider.min = 100000;
        slider.max = maxCredit;
        maxLabel.innerText = formatBRL(maxCredit);
        if (parseFloat(slider.value) < 100000) slider.value = 100000;
        if (parseFloat(slider.value) > maxCredit) slider.value = maxCredit;
        updateSlider(slider.value);
      } else { 
        section.style.display = 'none'; 
        helper.style.color = '#999';
        helper.innerText = "O valor m√≠nimo do im√≥vel deve ser R$ 300.000,00";
      }
      sendHeight();
    });

    function updateSlider(v) {
      document.getElementById('creditValue').value = formatBRL(parseFloat(v));
      state.creditVal = v;
    }
    document.getElementById('creditSlider').addEventListener('input', (e) => updateSlider(e.target.value));

    function validateStep3() {
      const input = document.getElementById('propertyValue');
      const container = document.getElementById('containerPropertyValue');
      const helper = document.getElementById('propertyHelper');
      const v = parseFloat(input.value.replace(/\./g, '').replace(',', '.')) || 0;
      if (v < 300000) {
        input.classList.add('input-error');
        container.classList.add('error-shake');
        helper.style.color = 'var(--color-error)';
        helper.innerText = "Aten√ß√£o: O valor m√≠nimo do im√≥vel deve ser R$ 300.000,00";
        setTimeout(() => { container.classList.remove('error-shake'); }, 400);
        return;
      }
      state.propertyVal = v; 
      nextStep();
    }

    async function submitForm() {
      const inputs = ['clientName', 'clientPhone'];
      let hasError = false;
      inputs.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value.trim()) { el.classList.add('input-error'); hasError = true; } else { el.classList.remove('input-error'); }
      });
      if (hasError) return;

      state.client = { 
        name: document.getElementById('clientName').value, 
        phone: document.getElementById('clientPhone').value, 
        cpf: document.getElementById('clientCPF').value, 
        income: document.getElementById('clientIncome').value,
        dob: document.getElementById('clientDob').value,
        cep: document.getElementById('clientCep').value
      };

      // 1. DISPARO WEBHOOK (MAKE.COM)
      const webhookURL = 'https://hook.us1.make.com/21rfmrwzxf5h5wmqkj9odgibeyky1ww7';
      try {
        fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(state)
        });
      } catch (e) { console.error(e); }

      // 2. DISPARO GOOGLE TAG MANAGER (DataLayer)
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        'event': 'simulador_athena_complete',
        'objective': state.objective,
        'property_type': state.type,
        'property_value': state.propertyVal,
        'credit_value': state.creditVal,
        'has_legal_doc': state.legal,
        'client_name': state.client.name,
        'client_phone': state.client.phone,
        'client_cpf': state.client.cpf,
        'client_income': state.client.income,
        'client_dob': state.client.dob,
        'client_cep': state.client.cep
      });

      // 3. COMUNICA√á√ÉO COM P√ÅGINA PAI (GREATPAGES)
      window.parent.postMessage({ event: 'simulation_complete', ...state }, "*");
      
      showStep('Success');
    }

    document.getElementById('clientIncome').addEventListener('input', (e) => maskMoney(e.target));
    document.getElementById('clientCPF').addEventListener('input', (e) => { e.target.value = e.target.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2").substring(0,14); });
    document.getElementById('clientPhone').addEventListener('input', (e) => { e.target.value = e.target.value.replace(/\D/g,"").replace(/^(\d{2})(\d)/g,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").substring(0,15); });
    document.getElementById('clientDob').addEventListener('input', (e) => { e.target.value = e.target.value.replace(/\D/g,"").replace(/(\d{2})(\d)/, "$1/$2").replace(/(\d{2})(\d)/, "$1/$2").substring(0,10); });
    document.getElementById('clientCep').addEventListener('input', (e) => { e.target.value = e.target.value.replace(/\D/g,"").replace(/^(\d{5})(\d)/, "$1-$2").substring(0,9); });
    
    window.onload = sendHeight;
  </script>
</body>
</html>
